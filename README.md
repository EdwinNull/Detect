# 开源组件包安全检测系统

这是一个基于机器学习和大语言模型的开源组件包安全检测平台，能够自动分析上传的组件包并识别潜在的安全风险。

## 🚀 主要特性

- **智能检测**: 结合XGBoost机器学习模型和DeepSeek大语言模型进行双重检测
- **多格式支持**: 支持ZIP、TAR.GZ、JAR、NPM、TGZ等常见组件包格式
- **特征提取**: 自动提取141项语言无关特征进行深度分析
- **实时进度**: 提供实时检测进度反馈和状态更新
- **风险评估**: 生成详细的风险分析报告和安全建议
- **用户管理**: 支持多用户管理和权限控制
- **报告导出**: 支持PDF和JSON格式的检测报告导出
- **移动端支持**: 响应式设计，支持移动设备访问

## 🛠️ 技术架构

- **后端**: Flask (Python)
- **前端**: HTML5 + CSS3 + JavaScript
- **数据库**: SQLite
- **机器学习**: scikit-learn (RandomForest模拟XGBoost)
- **大语言模型**: DeepSeek API
- **文件处理**: zipfile, tarfile
- **报告生成**: FPDF

## 📋 系统要求

- Python 3.7+
- 推荐内存: 4GB+
- 磁盘空间: 1GB+
- 网络连接: 用于访问DeepSeek API

## 🔧 安装和配置

### 1. 克隆项目
```bash
git clone <repository-url>
cd security-scanner
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 配置DeepSeek API
- 在 `app.py` 中更新 `DEEPSEEK_API_KEY` 为您的API密钥
- 当前使用的密钥: `************************`

### 4. 启动系统
```bash
python app.py
```

### 5. 访问系统
- 访问地址: http://localhost:5000
- 管理员账户: admin / admin123

## 📖 使用说明

### 用户登录
1. 打开浏览器访问 http://localhost:5000
2. 使用管理员账户登录：用户名 `admin`，密码 `admin123`

### 文件检测
1. 在首页点击上传区域或拖拽文件到上传区域
2. 选择要检测的组件包文件（最大100MB）
3. 点击"开始检测"按钮
4. 系统会显示实时检测进度
5. 检测完成后可查看详细结果

### 检测流程
1. **文件上传**: 上传组件包到服务器
2. **特征提取**: 提取141项语言无关特征
3. **XGBoost初筛**: 使用机器学习模型进行初步检测
4. **大模型复筛**: 使用DeepSeek进行深度安全分析
5. **生成报告**: 产生详细的安全评估报告

### 结果解读
- **风险等级**: 
  - 🟢 低风险: 组件相对安全
  - 🟡 中等风险: 存在潜在隐患，建议人工审查
  - 🔴 高风险: 检测到恶意特征，建议停止使用

- **置信度**: 
  - 80%+: 高可信度
  - 60-80%: 中等可信度，建议复查
  - <60%: 低可信度，需要谨慎对待

### 历史记录
- 查看所有检测历史
- 支持按文件名、风险等级、状态筛选
- 快速重新检测或查看详细结果

### 系统管理
管理员可以：
- 配置XGBoost模型参数
- 管理DeepSeek API设置
- 自定义提示词模板
- 查看系统统计信息
- 管理用户权限

## 🔍 检测原理

### 特征提取
系统提取141项语言无关特征，包括：
- 文件结构特征（文件数量、目录深度等）
- 大小分布特征（总大小、平均大小、最大文件等）
- 文件类型特征（可执行文件、脚本文件、配置文件等）
- 安全特征（隐藏文件、可疑扩展名等）
- 熵值特征（数据随机性分析）

### 检测算法
1. **XGBoost初筛**: 基于历史数据训练的梯度提升模型，快速识别明显的恶意和良性样本
2. **大模型复筛**: 对于置信度较低的样本，使用DeepSeek进行语义分析和风险评估
3. **结果融合**: 综合两种算法的结果，给出最终的风险等级和置信度

## 📊 API接口

### 上传文件
```
POST /upload
Content-Type: multipart/form-data

Response:
{
  "success": true,
  "scan_id": 123,
  "message": "文件上传成功，开始检测"
}
```

### 查询状态
```
GET /scan_status/<scan_id>

Response:
{
  "status": "completed",
  "progress": 100,
  "current_task": "检测完成"
}
```

### 获取结果
```
GET /results/<scan_id>
返回HTML页面显示详细检测结果
```

## 🛡️ 安全考虑

- 所有上传文件在检测完成后自动删除
- 用户会话采用安全的密钥管理
- API调用使用HTTPS加密传输
- 数据库密码使用哈希存储
- 支持文件大小和格式限制

## 🔧 配置选项

### 系统配置
- `MAX_CONTENT_LENGTH`: 最大文件上传大小（默认100MB）
- `UPLOAD_FOLDER`: 临时文件存储目录
- `DEEPSEEK_API_KEY`: DeepSeek API密钥
- `SECRET_KEY`: Flask会话密钥

### 算法参数
- XGBoost模型置信度阈值
- DeepSeek温度参数
- 特征提取参数
- 并发检测数量

## 📝 开发说明

### 项目结构
```
security-scanner/
├── app.py                 # 主应用文件
├── requirements.txt       # 依赖包列表
├── templates/            # HTML模板
│   ├── base.html
│   ├── login.html
│   ├── index.html
│   ├── progress.html
│   ├── results.html
│   ├── history.html
│   ├── admin.html
│   └── knowledge.html
├── static/               # 静态文件
│   └── reports/         # 生成的报告
├── uploads/             # 临时上传文件
└── security_scanner.db  # SQLite数据库
```

### 扩展功能
- 可集成更多机器学习模型
- 支持更多文件格式检测
- 添加更多特征提取算法
- 集成更多大语言模型API
- 增加实时威胁情报

## 🐛 故障排除

### 常见问题
1. **DeepSeek API调用失败**: 检查API密钥是否正确，网络连接是否正常
2. **文件上传失败**: 检查文件大小是否超过限制，格式是否支持
3. **检测卡住**: 检查后台进程是否正常，重启系统尝试
4. **数据库错误**: 删除 `security_scanner.db` 文件重新初始化

### 日志查看
系统运行时会在控制台输出详细日志，包括：
- 特征提取过程
- 模型预测结果
- API调用状态
- 错误信息

## 📄 许可证

本项目基于MIT许可证开源，详见LICENSE文件。

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📞 联系我们

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- Email: [您的邮箱]

---

**注意**: 这是一个演示系统，实际部署时请确保：
1. 更新所有默认密码和密钥
2. 配置适当的网络安全措施  
3. 定期备份数据库和配置文件
4. 监控系统资源使用情况 
